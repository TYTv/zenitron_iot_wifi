<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">





  <head>

    <title>Cypress WICED Ping Application</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />




    <!-- plot -->
    <style type="text/css">
      #flot-placeholder{width:350px;height:300px;}        
    </style>
    <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="http://www.pureexample.com/js/flot/excanvas.min.js"></script><![endif]-->
    <script type="text/javascript" src="../../scripts/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="../../scripts/jquery.flot.min.js"></script>
    <script src="../../scripts/general_ajax_script.js" type="text/javascript" ></script>
    <script type="text/javascript">

      // var data = [[1, 130], [2, 40], [3, 80], [4, 160], [5, 159], [6, 370], [7, 330], [8, 350], [9, 370], [10, 400], [11, 330], [12, 350]];
      var data = [];
      var sn = 1;

      /* <![CDATA[ */
      function reloadData( )
      {
        do_ajax( '/ping.html', ajax_handler);

        // read file
        jQuery.getJSON('../../buffer.json',
          function (buf) {
            // alert(JSON.stringify(data));
            // alert(data.BM1383GLV(hPa));
            // alert(data.BH1749_RED);

            $.each(buf, function(key, value){
              $.each(value, function(key, value){
                console.log(key, value);

                var tmp = [sn,value];
                sn = sn + 1;
                data.push(tmp);
                
                // tmp = [2,value];
                // data.push(tmp);
              });
            });

            // for (var key in buf) { 
            //   console.log(key, buf[key])
            // }

        });


        var dataset = [{label: "line1",data: data}];
        var options = {
            series: {
                lines: { show: true },
                points: {
                    radius: 3,
                    show: true
                }
            }
        };
        $(document).ready(function () {
            $.plot($("#flot-placeholder"), dataset, options);
        });



      }
      function ajax_handler( result, data )
      {
        var text = "";
        switch( result )
        {
            case AJAX_PARTIAL_PROGRESS:
            case AJAX_STARTING:
                break;
            case AJAX_FINISHED:
                document.getElementById("currentData").innerHTML = data;
                timeoutID = setTimeout('reloadData()', 1000);
                break;
            case AJAX_NO_BROWSER_SUPPORT:
                document.getElementById("currentData").innerHTML = "Failed - your browser does not support this script";
                break;
            case AJAX_FAILED:
                document.getElementById("currentData").innerHTML = "There was a problem retrieving ping data";
                break;
        }
      }
      /* ]]> */









      // button
      $("button").click(function(){



      });

    </script>



  </head>




  <body onload="reloadData( )" style="font-family:verdana;">

    <table border='0' cellpadding='0' cellspacing='0' width="98%">
      <tr style="height:20px"><td>&nbsp;</td></tr>
      <tr style="border-collapse: collapse; padding: 0;">
        <td style="width:20px"></td>
        <td style="width:152px"><img src="../../images/zenitron.gif" alt="Title Logo" /></td>
        <td style="vertical-align:middle; text-align:center; font: bold 25px/100% Verdana, Arial, Helvetica, sans-serif;background-image:url('../../images/line.png');">
        Zenitron IoT&copy;    Demo via Wi-Fi connection
        </td>
        <td style="width:137px;background-image:url('../../images/line.png');"></td>
      </tr>
      <tr><td>&nbsp;</td></tr>
    </table>
    <noscript><h2>Javascript is required for this page to work correctly.</h2></noscript>
      
    <!-- CYPRESS ROHM AZUREWAVE MICROCHIP -->
    <table border='0' cellpadding='0' cellspacing='0' width="98%">
      <tr style="border-collapse: collapse; padding: 0;">
        <td style="width:20px"></td>
        <td style="width:152px"><img src="../../images/cypress.jpg" alt="Logo" /></td>
        <td style="width:152px"><img src="../../images/rohm.jpg" alt="Logo" /></td>
        <td style="width:152px"><img src="../../images/azurewave.png" alt="Logo" /></td>  
        <td style="width:152px"><img src="../../images/microchip.png" alt="Logo" /></td>  
      </tr>
    </table>

    <!-- plot display -->
    <div id="flot-placeholder"></div>
    <div id="result"></div>
    <script>
      if(typeof(EventSource) !== "undefined") {
        var source = new EventSource("events");
        source.onmessage = function(event) 
        {
          document.getElementById("result").innerHTML += event.data + "<br>";
        };
      } 
      else 
      {
        document.getElementById("result").innerHTML = "Sorry, your browser does not support server-sent events...";
      }
    </script>

    <!-- data display -->
    <div style="margin-left:20px" id="currentData" >
      <p>Retrieving ping status...</p>
    </div>

    <!-- button -->
    <button>Refresh</button>

  </body>




</html>
